<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <title>YouVideo</title>
</head>
<body>
    <h1>YouVideo</h1>
    <video id="videoPlayer" controls></video>
    <script>
        async function fetchVideoBlob(videoId) {
            try {
                const response = await fetch(`/video/blob/${videoId}`, {
                    headers: {
                        'Range': 'bytes=0-'
                    }
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const videoBlob = await response.blob();
                const videoUrl = URL.createObjectURL(new Blob([videoBlob], { type: 'video/mp4' }));
                return videoUrl;
            } catch (error) {
                console.error('Error fetching video blob:', error);
            }
        }

        async function fetchVideoName(videoId) {
            try {
                const response = await fetch(`/video/name/${videoId}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                return data.videoName;
            } catch (error) {
                console.error('Error fetching video name:', error);
            }
        }

        window.onload = async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('id');
            if (videoId) {
                const videoName = await fetchVideoName(videoId);
                if (videoName) {
                    document.title = `${videoName} - YouVideo`;
                }
                const videoUrl = await fetchVideoBlob(videoId);
                const videoPlayer = document.getElementById('videoPlayer');
                videoPlayer.src = videoUrl;
            } else {
                console.error('Video ID not found in URL');
            }
        };
    </script>
</body>
</html>